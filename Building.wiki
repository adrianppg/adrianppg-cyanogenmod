=Building !CyanogenMod Stable=

== Prerequisites ==
As listed [http://source.android.com/download here], but JDK 6.0 (1.6) rather than 5.0 (1.5).

==Getting repo==
Follow the steps [http://source.android.com/download here] to set up repo for your system

==Setting Up==
  #. Create an empty directory to hold your working files.
    {{{
    $ mkdir source
    $ cd source
    }}}
  #. Initialize repo.
    {{{
    $ repo init -u git://github.com/abstrakraft/android-manifest.git
    }}}

==Downloading the Code==
  #. Sync the repository.  This step may take awhile.
    {{{
    $ repo sync
    }}}

===HTC Dream Only: Download Proprietary Code===
  #. Plug your G1 in via USB.
  #. Download the HTC G1 proprietary files.
    {{{
    $ cd vendor/htc/dream-open
    $ ./extract-files.sh
    }}}

==Building==
  #. Targets supported by this build process are:
    * htc_dream-eng
    * generic-eng
  #. Setup the environment.  Replace `<target>` with a target from the list above.
    {{{
    $ source build/envsetup.sh
    $ lunch <target>
    }}}
  #. Compile
    {{{
    $ make
    }}}
  #. If make errors with a message like "No rule to make target `run-java-tool'", execute the following command.
    {{{
    $ export ANDROID_JAVA_HOME=$JAVA_HOME
    }}}
    Explanation: Some distributions' java executables are symlinks to run-java-tool, which is generally a script that determines the appropriate jvm and tool to use.  Unfortunately, this interrupts Android's ability to determine the proper Java home directory, so it must be set manually.

==Kernel==
After running lunch as listed above:
  #.  Clone the cm-kernel repo.
    {{{
    $ git clone git://github.com/cyanogen/cm-kernel.git
    $ cd cm-kernel
    }}}
  #. Pull the config from an existing CyanogenMod phone and unzip it.
    {{{
    $ adb pull /proc/config.gz .
    $ gunzip config.gz
    $ mv config .config
    }}}
  #. Bring the configuration up to date with the current kernel.
    {{{
    $ make ARCH=arm oldconfig
    }}}
  #. Make the kernel and modules.
    {{{
    $ make ARCH=arm CROSS_COMPILE=arm-eabi zImage
    $ make ARCH=arm INSTALL_MOD_PATH=$ANDROID_PRODUCT_OUT/system/modules/ modules_install
    $ cp arch/arm/boot/zImage ../vendor/htc/dream_open/kernel
    }}}

Better kernel build process (to put modules in the correct place, and follow directions in vendor/htc/dream_open/README.txt) to come.

==Current Issues==
This process is in development, and does not currently build a complete cyanogenmod image.