=Getting repo=
Follow the steps [http://source.android.com/download here] to set up repo for your system

=Setting Up=
Create an empty directory to hold your working files:
$ mkdir mydroid
$ cd mydroid

Run repo init to bring down the 1.5r3 source. You must specify a URL for the manifest:
$ repo init -u git://android.git.kernel.org/platform/manifest.git -b android-1.5r3

Go to cyanogen's github page and download local_manifest-4.0.xml
http://github.com/cyanogen/android/downloads

Place it in the .repo folder in the mydroid folder you created earlier and rename it local_manifest.xml

=Building=
Create a makefile in the mydroid folder that has this text
include build/core/main.mk

Run:
$ make